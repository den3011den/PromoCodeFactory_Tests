Задание поможет отработать навыки написания тестов в ASP.NET Core проектах на xUnit.

Новые требования:

Для нормальной работы с партнерами решили добавить в систему список партнеров и вести их активность, также будет сохраняться количество промокодов, которые выдал партнер;
Приняли решение для части партнеров в ручном порядке продавать подписку на использование API. Для контроля подписки вводим лимиты на выдачу промокодов для партнеров и при попытке выдать промокод будем контролировать лимиты;
Лимиты будем задавать и отменять через API. Лимиты должны иметь дату создания, окончания и если отменим до даты окончания, то дату отмены, а также количество промокодов в лимите.

Описание/Пошаговая инструкция выполнения домашнего задания:
В домашнем задании нужно протестировать установку лимитов партнеру.

Тесты можно писать в файле SetPartnerPromoCodeLimitAsyncTests в проекте UnitTests.

Сделать форк репозитория домашнего задания и реализовать пункты в нем.

Нужно протестировать следующие Test Cases для установки партнеру (класс Partner) лимита (класс PartnerLimit) метод SetPartnerPromoCodeLimitAsync в PartnersController):

Если партнер не найден, то также нужно выдать ошибку 404;
Если партнер заблокирован, то есть поле IsActive=false в классе Partner, то также нужно выдать ошибку 400;
Если партнеру выставляется лимит, то мы должны обнулить количество промокодов, которые партнер выдал NumberIssuedPromoCodes, если лимит закончился, то количество не обнуляется;
При установке лимита нужно отключить предыдущий лимит;
Лимит должен быть больше 0;
Нужно убедиться, что сохранили новый лимит в базу данных (это нужно проверить Unit-тестом);
Если в текущей реализации найдутся ошибки, то их нужно исправить и желательно написать тест, чтобы они больше не повторялись.

Тесты должны соответствовать следующим условиям:

Использовать именование: ИмяЕдиницыТестирования_Условие_ОжидаемыйРезультат;
Для Arrange этапа должен использоваться фабричный метод при определении данных;
Для Stub и Mock использовать Moq;
Для создания тестируемого класса, например, PartnersController можно использовать AutoFixture (https://habr.com/ru/post/262435/), чтобы избежать ошибок компиляции при добавлении новых зависимостей в конструктор или также использовать фабричный метод;
Для проверки утверждения в тестах должен использоваться FluentAssertions;
В качестве дополнительного условия тестовые данные должны формироваться с помощью Builder, если не будет использоваться AutoFixture, то Mock и Stub также должны настраиваться через Builder;
В качестве дополнительного условия можно провести рефакторинг PartnersController или только метода SetPartnerPromoCodeLimitAsync на свое усмотрение, может быть ввести дополнительные классы для повышения удобства тестирования и сопровождения, если появятся дополнительные классы и методы, то они тоже должны быть протестированы, принцип расположения тестов в проекте соответствующий тестам в примере (Например, WebHost/Controllers/PartnersControllerTests); Если будет сделан рефакторинг, то при сдаче ДЗ поясните какие классы были введены;
В качестве дополнительного условия можно добавить прогон тестов CI в GitLab и при сдаче ДЗ прислать ссылку на прогон.
